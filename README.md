# T1D_Prediction Project Overview

## Background

Type 1 diabetes (T1D) is an autoimmune disease that develops after a latent period characterized by detectable immunological and metabolic changes. This repository contains early pancreatic transcriptome data and implements machine‑learning approaches to predict whether an individual will progress to T1D.

## Project Structure

Below is a high‑level overview of the repository directories and their contents:

| Folder/File           | Purpose                                                      |
| --------------------- | ------------------------------------------------------------ |
| **Dataset/**          | Contains all processed data after normalization. The `metadata.csv` file lists each sample’s name, group (Progressor, Non‑Progressor or N/A), collection time and batch. Under `DeseqScaffoldData` you find full gene expression matrices (`AllGeneFeature.csv`), differentially expressed genes (`EarlyStageDEGs.csv`), investigator‑selected top‑100 genes (`ScaffoldDeseqTop100.csv` and `ScaffoldJessSignature.csv`) . The `ImmuneCellsSignature` subfolder holds 100‑gene expression profiles for various immune cell types (e.g., BNaive, CD4EM, etc.); a markdown file (`parameter_blood_cells.md`) specifies suggested SVM kernels and parameters for each cell type. |
| **result/**           | Stores analysis outputs such as predicted probabilities for unknown batch 4 samples (`ProbabilityProgressorTestingSet.csv`) and training samples (`pred_train_matrix.csv`), subdirectories for ASS (Accuracy, Sensitivity, Specificity) transcriptomic analysis, immune‑cell analyses, random signatures and transcriptomic pipelines, and other summary files. |
| **temp_roc/**         | Holds intermediate ROC results generated by scripts. For example, `roc_oursig_1000.csv` contains mean ROC values for the custom signature in a 1000 run times trial, whereas `roc_deg_1000.csv` contains ROC results for differential genes. |
| **Jupyter Notebooks** | `ImmuneCells.ipynb` trains SVM models on immune cell datasets and performs parameter grid search. The script only able to train one type of immune cells at one time.  `parameter_blood_cells.md` can be referred for model paramter for each type of the immune cells used in our study. `ScaffoldTranscriptomic.ipynb` runs transcriptomic models on selected gene sets and computes average ROC curves. These two notebooks are the only files that need to be executed; they call the helper functions provided in the `func_*.py` modules. |
| **Helper scripts**    | Files prefixed with `func_` (e.g., `func_transcriptomic_svc.py`, `func_random_signature.py`) implement reusable routines for model training, random feature selection, ROC plotting and metric summarization. These are imported by the notebooks but are not executed directly. `bar_plot.py` draws probability bar charts; `func_metric_plot.py` creates box plots of accuracy, specificity and sensitivity; `func_roc_plot.py` plots ROC curves with 95 % confidence bands (assuming gaussian distribution); `func_transcriptomic_svc.py` handles SVC training on the transcriptomic dataset, returns averaged performance and writes ROC data; `func_random_signature.py` evaluates random gene signatures by repeatedly selecting random genes and training an SVC. |
| **PDF outputs**       | `ASS_figure.pdf`, `PredictionSamplesOutput.pdf` and `ROC_figure.pdf` provide visual summaries of the model results, including performance comparisons and ROC curves. |
| **Other files**       | `.idea/` contains IDE settings; these can be ignored.        |

### Visual Directory Tree

The following diagram summarizes the structure and relationships of the main folders and files in this project:

```
T1D_Prediction/
├── Dataset/
│   ├── metadata.csv
│   ├── DeseqScaffoldData/
│   │   ├── AllGeneFeature.csv
│   │   ├── EarlyStageDEGs.csv
│   │   ├── ScaffoldDeseqTop100.csv
│   │   ├── ScaffoldJessSignature.csv
│   │   ├── foldchange1.csv
│   │   └── foldchange2.csv
│   └── ImmuneCellsSignature/
│       ├── BNaive.csv
│       ├── CD4EM.csv
│       ├── CD4Naive.csv
│       ├── CD4Tfr.csv
│       ├── CD8EM.csv
│       ├── CD8Naive.csv
│       ├── DoubleNegative.csv
│       ├── GCB.csv
│       ├── MemoryB.csv
│       ├── Neutrophil.csv
│       ├── Plasmablast.csv
│       ├── Plasmacytoid.csv
│       └── Treg.csv
├── result/
│   ├── ProbabilityProgressorTestingSet.csv
│   ├── pred_train_matrix.csv
│   ├── ASS_*
│   ├── ImmuneCells/
│   ├── random/
│   └── transcriptomic/
├── temp_roc/
│   ├── roc_deg_1000.csv
│   ├── roc_oursig_1000.csv
│   └── ...
├── ImmuneCells.ipynb
├── ScaffoldTranscriptomic.ipynb
├── func_transcriptomic_svc.py
├── func_random_signature.py
├── func_metric_plot.py
├── func_roc_plot.py
├── bar_plot.py
└── ...
```



## Dependencies

The analysis requires Python 3.9 or later with the following packages, python 3.11 is used in all scripts:

```
pip install pandas numpy scikit-learn matplotlib seaborn
```

Jupyter Notebook or JupyterLab is needed to run the provided notebooks. 

## Running the Analysis

Only two Jupyter notebooks need to be executed to reproduce the results:

1. **Immune cells analysis** (`ImmuneCells.ipynb`): specifies a cell type, loads the corresponding 100‑gene signature and metadata, runs grid search to find the best SVM parameters, trains the model and predicts the test set. The recommended kernel and hyperparameters for each cell type are defined in `parameter_blood_cells.md`.
2. **Transcriptomic analysis** (`ScaffoldTranscriptomic.ipynb`): loads gene expression matrices from `DeseqScaffoldData`, trains SVMs (or other models) over many random splits, computes average accuracy, sensitivity, specificity and ROC curves, and writes prediction probabilities and ROC statistics.

The notebooks import helper functions from the `func_*.py` files. You do **not** need to run these scripts individually; they supply functionality such as SVC training, random signature evaluation, metric box plotting, ROC plotting and probability bar plotting.

## Output Interpretation

After running the notebooks, results will be written under `result/` and `temp_roc/`:

- After running the notebooks, results are organised under the `result/` and `temp_roc/` directories:
  - **Predicted probabilities:** `result/ProbabilityProgressorTestingSet.csv` lists the probability that each batch 4 sample is a progressor; `result/pred_train_matrix.csv` lists predicted probabilities for training samples.
  - **Transcriptomic performance (ASS):** The `result/ASSTranscriptomic/` subdirectory contains accuracy, sensitivity and specificity (ASS) metrics derived from the three gene‑expression datasets evaluated in **ScaffoldTranscriptomic.ipynb**. Each CSV summarises model performance on a particular gene set.
  - **Immune‑cell performance (ASS):** The `result/ImmuneCells/` subdirectory stores ASS metrics for each immune cell type analysed in **ImmuneCells.ipynb**. Within this folder, `result_used/` holds the summary metrics used in our study.
  - **Random signature performance:** The `result/random/` folder contains ASS metrics and ROC statistics for the random gene‑signature selections generated by **ScaffoldTranscriptomic.ipynb**.
  - **Temporary ROC data:** The `temp_roc/` folder (parallel to `result/`) holds intermediate ROC data files. These include mean false‑positive rate, mean true‑positive rate, 95 % confidence intervals and average AUCs. You typically do not need to open these files directly; the `roc_plot` functions in the notebooks and helper scripts will load them automatically.
  - **Figures:** PDF files summarise probability bar charts, performance box plots and ROC curves and can be found alongside their corresponding metrics in the `result/` folders

## Notes

- Samples with `Group` marked `N/A` in `metadata.csv` are unlabelled and used only for testing; they are excluded from model training.
- Many routines involve random splits or random feature selection; to reproduce results set explicit random seeds.

## Contributing and License

No license file is provided in this repository; please contact the original author before using the code or data in other projects. Contributions and improvements are welcome—feel free to submit pull requests along with updates to this documentation.